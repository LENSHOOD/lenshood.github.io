---
title: 构建可伸缩的平台工程技术栈
date: 2023-05-09 22:08:49
tags: 
- multi-runtime
- platform engineering
- multi-cluster
- multi-cloud
categories:
- Software Engineering
---

## 平台工程是新概念吗？

[平台工程（Platform Engineering）](https://platformengineering.org/blog/what-is-platform-engineering)，是通过为企业内部研发人员提供一整套工具链和资源以及知识，来更好的为研发人员构建工作流，以使研发团队在 DevOps 实践上更易于达成 [DORA Metrics](https://cloud.google.com/blog/products/devops-sre/using-the-four-keys-to-measure-your-devops-performance) 所描绘的高效能团队要求。

平台工程在企业内部一般是通过 IDP 内部开发者平台（Internal Developer Platforms）来落地实现。通过 IDP，研发人员能够方便灵活的对业务应用进行研发和交付，而不必将大量时间花费在学习和使用交付工作流所依赖的各种底层设施。而企业通过构建小规模的[平台工程团队](https://www.thoughtworks.com/zh-cn/radar/techniques/platform-engineering-product-teams)，开发并维护内部开发者平台，就能服务数倍于该团队人数的业务研发团队。

实际上，很多人在了解到平台工程这一概念后，都会心生疑惑：“平台工程是个新概念吗，听着耳熟啊？”，“这不就是我们公司的 xxx 平台吗？ （这里的 xxx 可能是 **研发管理平台** / **DevOps 平台** / **开发者平台** / **一站式运维平台** 等等”。

的确，至少在笔者所经历过的雇主、客户等诸多场景中，就接触过（甚至咨询过）不下 5 个类似的平台，虽然它们的名称、内部编号各不相同，但全都至少会提供包括代码仓、CI/CD 流水线、配置中心、制品库、资产管理、APM、日志监控、链路追踪等基础能力。通过这些能力，业务研发团队可以相对简单和方便的将业务交付到生产。

#### 真实企业的 DevOps

参考 2018 年由信通院组织起草的[《研发运营一体化（DevOps）能力成熟度模型》](https://hbba.sacinfo.org.cn/stdDetail/12bebc74402d9eced9cc0440ef6e4f879c11718e5df86101f985255fb24c35e0)，定义了：

> 研发运营一体化是指在 IT软件及相关服务的研发及交付过程中，将应用的需求、开发、测试、部署和运营统一起来，基于整个组织的协作和应用架构的优化，实现敏捷开发、持续交付和应用运营的无缝集成。

并且基于此进一步描述了 DevOps 在敏捷开发管理、持续交付和技术运营几个子项下对企业能力的要求。并通过一个成熟度模型来评估不同企业 DevOps 能力所处的阶段。

{% asset_img YDT-3763.png %}

显然 DevOps 能力的建设并不是只要通过几个工具组合起来就能落地的实践，而是一整套涉及管理、流程、工具和文化的体系化工程和变革。

许多企业没有精力和人才来构建整个 DevOps 体系，就只好先从便宜且收效快的地方入手：找原来的运维团队抽调几个人，采用开源方案搭建内部的代码仓（如 GitLab）和流水线（如 Jenkins），再手写一些通用的脚本来实现基础的制品部署。能有更多投入的企业，还会建设一些需求管理工具、资产管理工具等（对接云服务提供商的 API）。

![](https://kubesphere.io/images/devops/dev-ops.png)

但在业务开发团队的视角下，这些与 DevOps 相关的工作似乎还是 Tech Lead 或者专职 DevOps（是的，真有这一岗位）的职责。究其原因仍然是普通开发人员玩不转或者根本不想考虑代码到底如何才能交付上线。

上述实际情况大量存在于各类企业，这与 “You build it, you run it” 的 DevOps 精神是完全相悖的。此外由于与 DevOps 相关的工作通产会被代理给更资深的人员，因此他们的时间也被明显的侵占了。而随着云原生的不断发展，各类新的概念和实践被提出，研发人员愈发的感觉到知识追赶的压力，也就越来越抵触做 DevOps 相关的事情。

{% asset_imgcncf-landscape.png %}

真正具备了高 DevOps 成熟度的企业，有如下两种不同的实践：

1. 团队自组织的 DevOps 实践：完全开放的独立式团队，由成熟的研发人员组成，践行敏捷文化，根据实际情况自建或选择工具链（如 Github Actions），通过 IaC 确保流程和基础设施全部代码化管理，自主选择构建配置管理、Key 管理、可观测性等能力的方案。
2. 企业统一构建成熟的内部开发者平台：通过在企业内部搭建非常完善的平台、工具甚至基础设施，推行全公司一致的研发流程和团队管理实践，并通过构建复杂的指标体系来评估不同的研发团队并与绩效挂钩，自上而下的推动 DevOps 能力的提升。

上述两种不同的实践中，第一类更适合分散作战的小型精英团队，能快速且成本可控的交付软件。而对于第二类实践，其建设投入非常可观，更适合大型企业。事实上很多大型企业自建的内部开发者平台，已经和平台工程的概念内容逐步趋同了。



## 企业诉求的演进变化

cncf 平台工程白皮书

1. 架构图

1. 小规模：成本
2. 快速扩张：速度，扩展性
3. 大规模：易用性，稳定性，成本



## 可伸缩的软件栈架构

1. 软件栈（解决方案栈）
1. 总体架构
2. 云原生开发态与运行态
   1. nocalhost
   2. multi-riuntime
3. DevOps 能力
4. K8s 集群
5. 云基础设施
