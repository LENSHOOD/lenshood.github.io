---
title: 虚拟工厂：Java stream
date: 2020-05-03 23:07:27
tags:
- java
- stream
categories:
- Java
---

在我的文章 [虚拟工厂：Java 线程池]() 中简单介绍了采用 ”工厂“ 这样一个现实生活中的概念来抽象具体的线程操作，并定义了 `Worker` `TaskQueue` 等概念。用这种方式拉近了计算机域和真实世界域之间的距离，让代码表现现实的意图。

不仅仅是线程池，从 Java 8 开始引入的`Stream`也一样，它用代码构建了一套流水线体系，通过流水线环节的叠加来实现对流水线上元素的各种处理。

### Stream

Java 8 中定义的流式操作，能够对流（Stream）叠加多种操作并进行处理。首先，任何单一对象、集合、数组都可以输入为一个 Stream，转换为 Stream 后，他们都将变身为流中的一个元素，在对所有元素进行一番处理之后，Stream 可以再次转换回到对象、集合、数组等。那么，对于这 ”一番处理“，从处理的方式上划分，有以下几种处理形式：

1. 中间操作（Intermediate Operations）：

   - 无状态操作（StatelessOps）：对流中的每一个元素进行操作，元素之间没有关系，也不保存任何元素的状态。典型操作有：`filter` `maap` `peak` 等

   - 有状态操作（StatefulOps）：对流中元素的处理会依赖之前处理的结果，元素与元素之间有关系，下一个元素的处理依赖上一个元素的状态，或需要获取到所有的元素后才能进行操作。典型操作有：`distinct` `sorted` `limit`

2. 终止操作（Termination Operations）：

   - 