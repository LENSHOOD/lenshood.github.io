---
title: 性能工程在SDV的实践
date: 2024-03-20 21:38:54
tags:
- performance engineering
- performance optimization
- performance analysis
categories:
- Performance Engineering
---

当今的汽车与数年前的汽车相比，虽然作为载具的目的没什么变化，但不论是在驾乘体验、智能化水平还是交互方式上，都发生了质的飞跃。为了能支撑新一代汽车所提供的这种智能化服务水平，软件定义汽车（Software Defined Vehicle）势在必行，只有通过更加灵活和易于扩展的软件作为汽车的大脑，才能将传统的汽车升级为拥有诸如智能驾驶、深度娱乐、个性化人机交互能力的 “第三空间”。

SDV 带来了一系列汽车设计的革命性跨越，同时也引入了各种新的困难。诸如性能、可靠性、安全性、易用性等在软件领域长期存在的跨领域、跨业务型挑战，在软件定义汽车的同时，被一并引入了汽车研发的领域。

## 软件性能在 SDV 的挑战

软件领域没有新鲜事，正如从单体到分布式，从多任务到多实例，软件领域所面临的挑战总是伴随着业务形式和组织形式的发展。软件功能的扩展性和性能，总是冤家路窄，因此随着汽车软件规模的急剧扩大，扩展性差会降低研发效率，而扩展性要求的层层抽象却会对软件的性能设计造成局限。一切问题皆源于复杂度。

**无可避免的本质复杂度**

由于软件本身的架构灵活性，其功能构造十分易于修改和扩展，这也使得在表面上看，软件的规模似乎可以不受限制的扩大。然而人类的大脑是存在认知边界的，软件规模的扩大同样也意味着协作规模的扩大，这种大规模的软件协作体系，让软件的复杂度成倍提升。

从本质复杂度的角度看，任何软件在规模扩张的过程中都会陷入两类复杂性的泥潭：

- 晦涩性：软件研发的过程可以看做是知识传递和转换的过程，大规模软件的领域知识不掌握在任何单一个体的脑中，其更复杂的分工也造成了知识传递过程中的失真。若不加治理，这种晦涩性最终会导致整个软件系统无法被理解。
- 依赖性：大规模软件通常都包含了十分复杂的架构，其模块和组件之间通过各种形式的接口耦合相互依赖从而形成整体。但这种依赖性绝大多数时候是级连的，一旦处理不好，某个组件的修改可能突然导致其他看似毫无关联的组件发生故障。

不出意外，为了实现各种高阶智能化特性，SDV 驱动的汽车软件系统满足了复杂软件系统的一切特征。

【图】

以上图所示的汽车软件功能架构为例，汽车软件的架构具有业务繁杂、技术栈深、安全性要求高的特点。与其他行业如手机制造、互联网平台等的软硬件架构相比，汽车软件在各架构层级中的标准化程度更低，研发定制化的场景也更多，而整个汽车产业链中的各类供应商更是多如牛毛。

以上现状决定了汽车软件研发过程中，业务交互复杂、架构设计复杂、团队协作复杂。

**性能是一种横跨软件全业务、全生命周期的架构特性**

架构特性（Architecture Characteristics）是架构师在设计软件时需要考虑的与领域或业务需求无关的软件特性，如可审计性、性能、安全性、可伸缩性、可靠性等等。在很多时候我们也会称之为非功能性需求（Nonfunctional Requirements）或质量属性（Quality Attributes）。

在 [ISO/IEC 25010:2011](https://www.iso.org/standard/35733.html) 中，性能效率是软件质量模型中的一项关键架构特性，模型中将性能效率更具体的描述为软件的 “时间特性”、“资源利用率” 和  “容量”。

显然，软件性能是一种横跨业务和软件生命周期的通用架构特性。性能优劣在许多关键业务场景下都决定着客户的使用意愿，而为了得到高性能的软件系统，从软件的设计之初就需要开始考虑性能。

**持续提升软件性能在复杂的汽车软件体系中步履维艰**

汽车软件系统的复杂性特点，导致了持续性能优化的困难。这种困难主要体现在跨技术领域和跨业务领域和跨团队领域的三大挑战。

以导航功能为例：导航作为车上非常关键的应用，如果出现迟滞、卡顿、退出等问题，会严重影响用户的驾车体验。因此为了确保导航使用的流畅性，在运行时需要有更多的系统资源，以及更稳定的运行环境。

操作响应快要求导航进程的调度优先级更高，连续读图要求 IO 排队时间短，画面渲染涉及如 Unity3D 等的第三方库以及 GPU 资源，另外导航中的一些辅助功能如AI语音，画面共享等则需要调用其他组件的能力。

因此对于导航这项关键功能，如果发现性能故障，其定位和优化的过程可能牵涉多个业务领域，以及包括应用层、中间件层和系统层等多个技术层，此外还可能会牵扯信息安全、体验一致性以及系统可靠性等诸多问题。

**通过工程化方法治理复杂度，持续提升性能**

工程化方法指通过科学的方法和标准化流程，来提升项目的效率和质量。因此对于“性能优化”这样的项目，通过工程化方法可以降低性能优化实施门槛，并提升其效率。简而言之，性能工程就是通过如下五个方面的实践来实现工程化的性能优化。

- 系统方法论：性能优化的体系化方法，可参照如《性能之巅》等的性能分析和优化方法论。

- 标准化流程和规范：定义如性能建模以及自动化方法（如适应度函数）等的标准化流程，提升效率。

- 成熟的技术支持：构建性能工程团队所需的知识、人才和技术能力。

- 全生命周期管理：类似 DevOps 的方式，对软件全生命周期的性能优化活动进行定义。

- 持续改进：通过持续观测、持续看护等手段将性能优化的实践持续运行。

## 持续性能观测

1. 评估模型
2. 定制化和可扩展的观测工具
3. 区分场景和开销
4. 数据关联性
5. 劣化看护

## 持续性能改进

1. 评估模型
2. TopDown 分析
3. 构建基准测试
4. 调优跷跷板
5. 优化看护

## 性能工程团队

1. 团队拓扑
2. 平台能力构建
3. 教练团队
4. 性能优化专家能力

## 总结

