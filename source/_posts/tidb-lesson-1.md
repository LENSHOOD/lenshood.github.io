---
title: TiDB 学习课程 Lesson-1
date: 2020-08-14 20:51:26
tags:
- tidb
categories:
- TiDB
---

今年了解到 TiDB 这样一个 HTAP 数据库，在 Github 上面热度超高，再加上国人开发与维护，因此产生了很大的兴趣。

正好社区搞了一个《高性能 TiDB 课程学习计划》通过 12 节课来使学员能达到 Committer 的水平，因此就报名参加啦。

第一节课的课程作业是*尝试在本地启动一个最小集群，并在开启事务时打印 “hello transaction” 并将这一过程写成一片文章*，因此本文将会主要描述这一过程。

### 简单介绍 TiDB 架构

TiDB 是一款支持 SQL 语义并直接兼容 MySQL 通信协议的分布式关系型数据库。可以看到这句话里面包含了三个很重要的信息：

- 兼容 MySQL
- 关系型数据库
- 分布式

假如作为一个业务开发者，从外部来看，TiDB 在绝大多数情况下直接表现为一个 MySQL，业务中的各种 Select 查询，表关联，以及对事务、ACID 的要求，它都能满足。在此基础上，通过分布式实现了方便的动态扩缩容，以及高性能。

那么 `MySQL + 分布式` 这样一个在传统互联网应用中想要而不可得的东西，TiDB 是如何实现的呢？请看下图（转载自 PingCAP 官网，一切版权归其所有）：

![](https://download.pingcap.com/images/docs-cn/tidb-architecture-1.png)

整个数据库集群分为三类模块：

- tikv：分布式 K-V 存储，通过 Raft 协议保证强一致性实现多副本的高可用，是数据的实际存储位置
- tidb：接受客户端连接，解析 SQL 语句，并转换为访问 tikv 的计算，最后收集数据并返回
- pd：placement driver，管理整个集群的元信息，并负责 tikv 节点的调度。

上述模块全都都可以多节点部署。

了解了总体架构后，我们发现，外表上看似乎是一台 MySQL，实际上除了对 MySQL 协议的支持以外，其内部结构已经和 MySQL 没有太大关系了。相比之下，TiDB 可能更像一个 Spark 集群，因此其实 TiDB 就是一个根正苗红的分布式数据库方案。

### 从源码开始部署

如果只谈部署的话，其实 TiDB 提供了一个非常方便的集群部署工具：TiUP，在[《TiDB in action》的安装部署章节中](https://book.tidb.io/session2/chapter1/tiup-tiops.html)，非常清楚的描述了 TiUP 的使：不论是部署单机测试环境还是部署集群，几条命令就能全部搞定了。

不过在我们当前的上下文中，是想要从源码开始部署的，所以，接下来我会暂时先抛开 TiUP，直接从源码开始。