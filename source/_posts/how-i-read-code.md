---
title: 我是怎么读代码的
date: 2022-05-22 17:05:12
tags:
- source code
Categories:
- Others
---

作为一名程序员，总有一些时候，会对自己所做的重复性的工作感到厌倦，也会羡慕明星项目做的热火朝天 star 数蹭蹭上涨。

读一读别人优秀的代码，既能缓解焦虑，又能拓展视野。每当读懂软件的精彩设计，赞叹优美整洁的代码，甚至发现藏在注释中的彩蛋时，都好像在不同的时空与作者产生了交叉，畅快的聊了会儿天。

读代码很有趣，但能读通读懂也很费功夫。本文是笔者在日常读代码中的一点心得，分享出来，希望能与读者产生共鸣。



### 怎样寻找一位好老师

优秀的项目就像一位好老师，我们可以全方位的从它身上学到各种领域的知识。

不过在开始读代码之前， 最大的问题就是：**怎么样找到合适的代码项目**？

star 数高的项目相对更优秀吗？从某些角度讲的确是的，但是在 [gitstar-ranking](https://gitstar-ranking.com/repositories) 上， 4k 个 star 的 repo 只能排到第 5000 名，而至少有 50k 个 star 才有可能排进前一百。光看 star 数，这太多了。

在我看来，通过如下的几个方向来筛选，能选到相对合适的项目：

##### 兴趣使然

首先就是一定要选自己感兴趣领域的项目。

不少代码片段都是比较枯燥而难以阅读的（比如飞一般的位操作，为提升性能而莫名其妙的语句，或是包含了大量隐含知识等等），只有自己感兴趣，才会有读下去的意愿和动力，才能在其中发现乐趣。

有时候我们开始读代码的契机就单纯是在工作当中用到了，想要进一步了解其原理和设计，这是一个不错的起点。想必很多同学第一次看源码都是因为一层层追到了 Spring 的 class 里面去吧。

有的时候可能就是觉得某项技术很神奇，像魔法一样，很想了解它是怎么施法的。（我就是因为觉得神奇所以去看了 kubelet 的代码）

总之一旦有了兴趣，就会很像进一步了解它。但如果读到一半又失去了兴趣，也请大胆的放弃它。失去了这一片草丛，还有整个树林等着我们去探索。



##### 经典且被大量使用

经典的、拥有大量用户的项目，经历了时间的考验，不断的迭代，通常在设计上都有很多出众之处。

经典项目的维护者一般都是非常资深的工程师，并且也都会有大公司赞助，确保了代码的高质量。这类项目在阅读的过程中能学到很多知识，例如架构抽象、性能优化、工程化等等。

这类典型的项目就如：Go、Linux、MySQL。K8S 等等。



##### 合适的规模

代码量太过庞大的项目，虽然很经典，但难免令人生畏。

实际上可以找到很多规模不大，但依然完整实现设计思想的项目。

首先就是各种语言的标准库，比如 Java 的 Stream、AQS 等等。另外也有许多开源的规模不大的优秀项目，比如 redis、leveldb 等。另外，许多经典大学课程里面的 Lab 也隐藏着优秀的项目，比如 xv6。

总之，这一类代码可能几天或几周就能大致看完主干，特别适合学习设计思想。



### 先读文档

选定了项目，我们一定已经对它做了什么事以及最基本的概念和原理有浅尝辄止的了解了。

这时候，尽量不要直接clone 代码开始阅读。通常对于事物的理解，从全局到部分，从抽象到细节是一个比较容易让人接受的过程。

代码的特点就是事无巨细的包含了所有知识，但也将细节毫无保留的暴露出来，直接进到代码容易迷失方向。



##### 了解概览

成熟的项目通常会有比较详尽的文档，文档一般分两类：给用户看的使用文档，和给贡献者看的开发文档。

通过阅读使用文档我们能快速的了解到项目创立的目的、解决了哪些问题，以及从用户的视角看该软件是什么样子的。除了看 overview，我也会大致的关注配置，通过必填配置可以进一步的了解软件的依赖和外部特性。



##### 架构和模块

优秀的开发文档一定会包括整个软件的架构模型，和关键模块的设计。

通过阅读架构图和高层设计，软件的原理或到底是采用什么方式来解决问题的会一目了然。对于有一定经验的读者甚至可能看到架构设计后就已经能大概知道软件的工作流程了。

除了架构设计，比较完善的开发文档也会包含关键模块的设计。关键模块可能会包含核心逻辑的设计和数据结构，以及边界处的契约和交互方式。

（举例子比如 leveldb 的文件模型）

搞明白了架构模型和关键模块，真正打开源码时就会将包、文件名、接口等等包含的知识与整体结构相互映射，在脑中形成一张完整的图。



##### 其他的前置知识

有时候文档的作者还会添加不少前置知识，比如基于什么样的算法，受到了哪些知识的启发甚至是实现了哪篇论文的思想等等。

如果能有这些前置知识，对我们的理解会大有帮助。因为我们可以通过学习这些知识来进一步了解软件的细节设计。



### 从代码入口开始

- 抓住主线
- 一层层逐步向下，从抽象到实现
- 记下中间遇到的拓展知识，逐步查阅资料并消化



### 写篇文章讲讲整个设计

- 先梳理大纲
- 再描述设计原理，通过画图帮助分析设计意图
- 之后想一想，为什么要这么设计，好处在哪里？
- 最后把为什么放到怎么做之前



### 讲个 session 可以带来额外的 bonus

- 梳理要点，逻辑自洽
- 去粗取精，锻炼表达
- 揣摩听众感兴趣的方向
